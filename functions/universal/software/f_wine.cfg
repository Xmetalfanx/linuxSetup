###################################################################################
# Start of Wine related code 

## Adds Wine keys for ALL Ubuntu based installs
function addUbuntuWineKeys()
{
  # Source: https://wiki.winehq.org/Ubuntu

  echo -e "The WineHQ repository key was changed on 2018-12-19. If you downloaded and added the key before that time, you will need to download and add the new key and run sudo apt update to accept the repository changes."

  echo -e "Beginning with Wine 4.5, the wine-devel packages for Ubuntu 18.04 and 18.10 require libfaudio0 as a dependency. Since the distro does not provide it, libfaudio0 packages can be downloaded from the OBS. See https://forum.winehq.org/viewtopic.php?f=8&t=32192 for details"  

  clear
  # Add architecture 
  sudo dpkg --add-architecture i386

  # Add Key
  wget -nc https://dl.winehq.org/wine-builds/winehq.key
  sudo apt-key add winehq.key

}

function wineOpenSuseLeapInstall()
{
  echo -e "Installing PlayonLinux"
  case $distroBase in 
    opensuse) $install playOnLinux ;; 

    arch|fedora|solus|ubuntu) $install playonlinux ;;

  esac 

}

function wineRepoSuse
{

		clear
		echo -e "Installing Wine Repo "

		repoName=WINE Repository

		echo "Adding WINE Repo for added Software"

    case $openSUSEBranch in 

    leap) wineOpenSuseLeapInstall ;; 

    tumbleweed) wineRep="http://download.opensuse.org/repositories/Emulators:/Wine/openSUSE_Tumbleweed/" ;; 

    *) echo "Version can not be determined, Wine not installed" ;; 

    esac 

    # this function name CAN'T be right 
		suseAddRepoName $repoName $wineRepo

}


function wineLinuxMintRepo()
{
  case $lsbRelease in 

    19) sudo apt-add-repository 'deb https://dl.winehq.org/wine-builds/ubuntu/ bionic main' ;;

    18) sudo apt-add-repository 'deb https://dl.winehq.org/wine-builds/ubuntu/ xenial main' ;; 

    17) sudo apt-add-repository 'deb https://dl.winehq.org/wine-builds/ubuntu/ trusty main' ;; 

  esac 

}

function wineUbuntuRepos()
{

  # Add Repo

    # Ubuntu 18.04 - Bionic
    if  [ "lsbCodename" = 'bionic' ] || \
        [ "$lsbRelease" = '18.04' ]; then

        sudo apt-add-repository 'deb https://dl.winehq.org/wine-builds/ubuntu/ bionic main'

    # Ubuntu 16.04 - xenial
    elif  [ "lsbCodename" = 'xenial' ] || \
          [ "$lsbRelease" = '16.04' ]; then 

        sudo apt-add-repository 'deb https://dl.winehq.org/wine-builds/ubuntu/ xenial main'

    #  18.10 - End of life 18.10, July 2019 
    elif  [ "lsbCodename" = 'cosmic' ] || \
          [ "$lsbRelease" = '18.10' ]; then

      sudo apt-add-repository 'deb https://dl.winehq.org/wine-builds/ubuntu/ cosmic main'

    fi 

}

function wineUbuntuBasedInstall()
{
    ## Refresh repos 
    $refresh
    clear

    # install 
    $install --install-recommends winehq-stable

    $install playonlinux

}

######################################################################################
## The Meta Wine Function 
function installWine()
{
    programName="Wine Emulator"
    programHomepage=http://www.winehq.com
    
    # this will not work in all cases as some distros use "wine-stable" or "wine-developement"
    packageNames="wine playonlinux"

    if [ $distroBase = "ubuntu" ]; then
        
        addUbuntuWineKeys
        
        # Add Repos
        wineUbuntuRepos

        #refresh/install once repos are added
        wineUbuntuBasedInstall

        # Linux Mint Checks - idea is there is no need to go threw the ubuntu section, if the distro is clearly Mint 
    elif [ $lsbDistribID = "LinuxMint" ]; then
        
        addUbuntuWineKeys
        
        # Add Repos
        wineLinuxMintRepo

        #refresh/install once repos are added
        wineUbuntuBasedInstall

    elif    [ $distroBase = "arch" ] || \
            [ $distroBase = "fedora" ] || \
            [ $distroBase = "opennsuse" ] || \
            [ $distroBase = "solus" ]; then
        
        # Wine is in the default repos 
        $install $packageNames
        
        #Debugging prompt only
        userPrompt
    
    else
      echo "Errors installing W.I.N.E. "
    fi

}