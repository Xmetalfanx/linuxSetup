. ${softwareDir}/multimedia/strawberry/f_strawberry_branch_checks.cfg


function strawberry_set_variables() {
  programName="strawberry"
  programTitle="Strawberry Media Player"
  programHomepage="https://www.strawberrymusicplayer.org/"
  strawberry_download="https://www.strawberrymusicplayer.org/#download"

  # 99.9% sure the PPA is maintained by the creator of the program 
  PPASource="https://launchpad.net/~jonaski/+archive/ubuntu/strawberry"

  PPALink="ppa:jonaski/strawberry"
}


function handle_strawberry_gitpage_download() { 

  # Debian 
    ## Debian 12 (oldstable) - bookworm
    ## Debian 13 (stable) - trixie

  # Ubuntu
    # 20.04 - focal
    ## 22.04 - Jammy
    ## 24.04 - Noble
    ## 25.04 - Plucky

  # I am not sure the * case is needed but ... just in case ... leave it .. not alot of code and it 
  # doesn't hurt anything 
  # ? i have debian here and the debian programURL set below... why? 
  case "$distroBase" in
    debian) branch="${debian_branch}" ;;
    
    fedora) branch="${fedora_branch}" ;;
    opensuse) 

      # should i put an exit code here?
      [ "$openSUSEBranch" = "leap" ] && branch="${leap_branch}" 
      [ "$openSUSEBranch" = "tumbleweed" ] && installApp "strawberry"

    ubuntu) branch="${ubuntu_branch}" ;;
    *) echo "Unsupported distroBase: $distroBase" ; return 1 ;;
  esac

  # idea if focal, maybe hardcode (not something i typically do), 
  # the last DEB URL that supports focal
  # the return prevents the rest of the code from executing
  if [ "$distroBase" = "ubuntu" ] && [ "$ubuntu_branch" = "focal" ]; then
    fancy_message info "Support for Ubuntu 20.04, needs extra work and is not done yet" && return 1
    
    return
  fi

  strawberry_filter="-${branch}_amd64.deb"

  # gets the download link for most releases
  # ubuntu focal which is not supported in recent releases, is the expection 
  get_and_handle_github_downloads "jonaski" "strawberry" "${strawberry_filter}"


}


function handle_strawberry_ubuntu_menu() {
  echo "How would you like to install Strawberry Media Player?"
  echo "1) Github release page"
  echo "2) Flatpak"
  echo "3) PPA"


  if [ "${ubuntu_branch}" == "jammy" ]; then
    echo -e "\nNOTE: On Jammy, the version available via Github or PPA is a year old due to the Strawberry refactor after Jammy.\n"
  fi
  read -p "Enter your choice (1/2/3): " strawberry_choice
  
  case "$strawberry_choice" in
    1)  handle_strawberry_gitpage_download ;;
    2)
      # ref: https://flathub.org/en/apps/org.strawberrymusicplayer.strawberry
      installFlatpakApp ${strawberryFP}
      ;;
    3)
      echo "You chose PPA."
      installStrawberryPPA
      ;;
    *)
      echo "Invalid choice."
      ;;
  esac
}


######################################################
# do i need to pass anything as $1 or can i use distro codenames?
function getStrawberryURL() {

  starwberry_download_links=$(curl -s "${strawberry_download}" | awk -F '"' '/https:\/\/file/ { print $2 }')

 
  # Sept 2025: the fedora and opensuse code no longer makes sense since i dont have 
  # strawberryDownload.... these two distros (?will openSUSE TW be an issue?) 


  case $distroBase in
    debian|fedora|opensuse) handle_strawberry_gitpage_download ;;

    ubuntu) handle_strawberry_ubuntu_menu  ;;

  esac

}
###############################################################################################


###############################################################################
# Meta function
function installStrawberry() {
  strawberry_set_variables

  clear
  fancy_message action "Installing $programTitle"

  # Nov 2022 idea: this may be redone (or maybe just the functions listed in the case's will be) to maybe all use "gitDownload" when i get that working
  case $distroBase in

    arch|solus) installApp "strawberry" ;;
    debian|fedora|opensuse|ubuntu) strawberry_branch_distro_check  ;;

  esac

}
