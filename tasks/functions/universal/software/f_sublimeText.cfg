###  Menu and Key related functions

function sublimetextMenu
{
  ## Determine if the user rather use the stable OR the dev branch
  x=1
  while [ $x=1 ]; do

    echo -e "Please Select the branch you want to use \n"

    echo -e   "S. \t Sublime-Text Stable"
    echo -e   "D. \t Sublime-Text Dev(eloper)"

    echo -e   "q. \t Exit to Prompt \n\n"
    read -p   "Your Choice?:" mainSelection

    case $sublimeSelection in

      [sS]) sublimebranch='stable'
            x=0
            ;;
      [dD]) sublimebranch='dev'
            x=o
            ;;

      * ) invalidSection
          x=1
          ;;

      esac
    done

}

function sublimeTextKeys
{

  echo -e "Installing the GPG key"

    if [ "$distroBase" == 'ubuntu' ]; then
      wget -qO - https://download.sublimetext.com/sublimehq-pub.gpg | sudo apt-key add -
      echo -e "GPG Key for Sumblime-Text is Installed"

    elif [ "$distroBase" == 'fedora' ]; then
      sudo rpm -v --import https://download.sublimetext.com/sublimehq-rpm-pub.gpg
      echo -e "GPG Key for Sumblime-Text is Installed"

    elif [ "$distroBase" == 'opennsuse' ]; then
      sudo rpm -v --import https://download.sublimetext.com/sublimehq-rpm-pub.gpg
      echo -e "GPG Key for Sumblime-Text is Installed"

    elif [ "$distroBase" == 'arch' ]; then
      curl -O https://download.sublimetext.com/sublimehq-pub.gpg && sudo pacman-key --add sublimehq-pub.gpg && sudo pacman-key --lsign-key 8A8F901A && rm sublimehq-pub.
    else
      echo -e "Sublime-Text Key has NOT been added/installed"
  fi

 }

#####################################################################################
## Separate functions for each distro base ... hopefully this will make what was nested if-elif statements look clear
function sublimetextInstallUbuntu
{
    ## Including extra package in case its not already installed
    sudo apt-get install apt-transport-https

      #Select the channel to use:
      if [ "sublimebranch" == 'stable' ]; then
        #Stable
        echo "deb https://download.sublimetext.com/ apt/stable/" | sudo tee /etc/apt/sources.list.d/sublime-text.list

      elif [ "sublimebranch" == 'dev' ]; then
        #Dev
        echo "deb https://download.sublimetext.com/ apt/dev/" | sudo tee /etc/apt/sources.list.d/sublime-text.list
      fi

}


function sublimetextInstallArch
{

    if [ "sublimebranch" == 'stable' ]; then
      #Stable
      echo -e "\n[sublime-text]\nServer = https://download.sublimetext.com/arch/stable/x86_64" | sudo tee -a /etc/pacman.conf

    elif [ "sublimebranch" == 'dev' ]; then
      #Dev
      echo -e "\n[sublime-text]\nServer = https://download.sublimetext.com/arch/dev/x86_64" | sudo tee -a /etc/pacman.conf
    fi
}


function sublimetextInstallFedora
{

    if [ "sublimebranch" == 'stable' ]; then
      sudo dnf config-manager --add-repo https://download.sublimetext.com/rpm/stable/x86_64/sublime-text.repo

    elif [ "sublimebranch" == 'dev' ]; then
      sudo dnf config-manager --add-repo https://download.sublimetext.com/rpm/dev/x86_64/sublime-text.repo
    fi


}

function sublimetextInstallOpenSuse
{
    if [ "sublimebranch" == 'stable' ]; then
      #Stable
      sudo zypper addrepo -g -f https://download.sublimetext.com/rpm/stable/x86_64/sublime-text.repo
    elif [ "sublimebranch" == 'dev' ]; then
      #Dev
      sudo zypper addrepo -g -f https://download.sublimetext.com/rpm/dev/x86_64/sublime-text.repo
    fi



}
##############################################################################################
function sublimetextInstall
{

  # Call to Menu function
  sublimetextMenu

  # Function to get the keys needed
  sublimeTextKeys


  # Check to see what distro is being run and do the appropriate tasks, depending on what is detected
  if [ "$distroBase" == 'ubuntu' ]; then
      sublimetextInstallUbuntu

    elif [ "$distroBase" == 'fedora' ]; then
      sublimetextInstallFedora

    elif [ "$distroBase" == 'opennsuse' ]; then
      sublimetextInstallOpenSuse

    elif [ "$distroBase" == 'arch' ]; then
      sublimetextInstallArch

    else
       echo "FILLER TEXT FOR NOW ... "
    fi

    clear
    installApp sublime-text
    echo -e "Sublime Text Installed"
}
